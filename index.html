<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Society Finance Manager Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="app" class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
        <div id="loading" class="text-center py-10"><p class="text-slate-500">Loading Application...</p></div>

        <div id="auth-container" class="hidden max-w-md mx-auto bg-white rounded-2xl shadow-lg p-8 mt-10">
             <h2 class="text-2xl font-bold text-center">Society Login</h2>
             <form id="loginForm" class="mt-6">
                 <div class="mb-4"><label for="loginEmail" class="block text-sm font-medium">Email</label><input type="email" id="loginEmail" required class="mt-1 w-full border-slate-300 rounded-md p-2"></div>
                 <div class="mb-6"><label for="loginPassword" class="block text-sm font-medium">Password</label><input type="password" id="loginPassword" required class="mt-1 w-full border-slate-300 rounded-md p-2"></div>
                 <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-md">Login</button>
             </form>
             <p id="authError" class="text-red-500 text-sm mt-4 text-center"></p>
        </div>

        <div id="content-container" class="hidden">
            <header class="mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4">
                <div>
                    <h1 id="header-title" class="text-3xl md:text-4xl font-bold text-slate-900">Finance Dashboard</h1>
                    <p class="text-slate-500 mt-2" id="welcomeMessage"></p>
                </div>
                <button id="logoutButton" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-md shadow-md w-full sm:w-auto">Logout</button>
            </header>

            <div id="dashboard-view">
                <div class="mb-8">
                    <div id="total-balance-card" class="bg-teal-600 text-white p-6 rounded-lg shadow-lg">
                        <h3 class="font-medium text-teal-100">Total Society Balance (from Summaries)</h3>
                        <p id="total-society-balance" class="text-4xl font-bold mt-2">₹0.00</p>
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-slate-800 mb-4">Detailed Finance Sheets</h2>
                <div class="flex flex-col sm:flex-row justify-end gap-3 mb-4">
                    <button id="manage-residents-btn" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md">Manage Residents</button>
                    <button id="open-sheet-recycle-bin-modal" class="bg-slate-500 text-white font-semibold py-2 px-4 rounded-md">Sheet Recycle Bin</button>
                    <button id="open-create-sheet-modal" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md">+ Create New Sheet</button>
                </div>
                <div id="sheets-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <p id="no-sheets-message" class="text-center text-slate-500 py-16 hidden">No finance sheets yet.</p>

                <div class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-slate-800">High-Level Monthly Summary</h2>
                        <button id="open-add-month-modal" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-md shadow-md hover:bg-green-700">+ Add Month Summary</button>
                    </div>
                    <div id="monthly-summary-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                    <p id="no-summary-message" class="text-center text-slate-500 py-16 hidden">No monthly summaries added yet.</p>
                </div>
            </div>
            
            <div id="residents-view" class="hidden">
                 <div class="mb-6"><button id="back-to-dashboard-from-residents" class="text-blue-600 font-semibold flex items-center">&larr; Back to Dashboard</button></div>
                 <div class="bg-white p-6 rounded-lg shadow-md">
                     <h2 class="text-2xl font-semibold mb-4">Manage Residents</h2>
                     <form id="resident-form" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-6 gap-4 items-end mb-6">
                         <div class="md:col-span-1"><label for="r-flat" class="text-sm">Flat No.</label><input type="text" id="r-flat" placeholder="A-101" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                         <div class="md:col-span-2"><label for="r-name" class="text-sm">Owner Name</label><input type="text" id="r-name" placeholder="Mr. Sharma" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                         <div class="md:col-span-1"><label for="r-amount" class="text-sm">Maint. Amount</label><input type="number" id="r-amount" placeholder="2500" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                         <div class="md:col-span-1"><label for="r-status" class="text-sm">Status</label><select id="r-status" class="mt-1 w-full p-2 border-slate-300 rounded"><option value="Sold">Sold</option><option value="Unsold">Unsold</option><option value="Exempt">Exempt</option></select></div>
                         <div class="flex gap-2 md:col-span-1">
                             <button type="submit" id="resident-submit-btn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md">Add</button>
                             <button type="button" id="resident-cancel-btn" class="w-full bg-slate-200 py-2 px-4 rounded-md hidden">Cancel</button>
                         </div>
                     </form>
                     <div class="overflow-x-auto"><table class="w-full">
                         <thead class="bg-slate-50"><tr>
                            <th class="p-3 text-left text-xs uppercase">Flat No.</th> <th class="p-3 text-left text-xs uppercase">Owner Name</th> <th class="p-3 text-left text-xs uppercase">Amount</th> <th class="p-3 text-left text-xs uppercase">Status</th> <th class="p-3 text-center text-xs uppercase">Actions</th>
                         </tr></thead>
                         <tbody id="residents-table-body" class="divide-y"></tbody>
                     </table></div>
                 </div>
            </div>

            <div id="detail-view" class="hidden">
                 <div class="mb-6 flex justify-between items-center">
                    <button id="back-to-dashboard-from-detail" class="text-blue-600 font-semibold flex items-center">&larr; Back to Dashboard</button>
                    <button id="export-excel-btn" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-md shadow-md hover:bg-green-700">Export to Excel</button>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-purple-100 p-6 rounded-lg"><h3 class="font-medium text-purple-600">Opening Balance</h3><p id="opening-balance" class="text-3xl font-bold mt-2">₹0.00</p></div>
                    <div class="bg-blue-100 p-6 rounded-lg"><h3 class="font-medium text-blue-600">Collected (This Month)</h3><p id="total-collected" class="text-3xl font-bold mt-2">₹0.00</p></div>
                    <div class="bg-red-100 p-6 rounded-lg"><h3 class="font-medium text-red-600">Expenses (This Month)</h3><p id="total-expenses" class="text-3xl font-bold mt-2">₹0.00</p></div>
                    <div id="balance-card" class="p-6 rounded-lg"><h3 id="balance-label" class="font-medium">Closing Balance</h3><p id="closing-balance" class="text-3xl font-bold mt-2">₹0.00</p></div>
                </div>

                <div class="border-b border-gray-200 mb-6">
                    <nav class="-mb-px flex space-x-6" id="detail-tabs">
                        <button data-tab="status" class="py-4 px-1 border-b-2 font-medium text-sm tab-active">Payment Status</button>
                        <button data-tab="collection" class="py-4 px-1 border-b-2 font-medium text-sm text-gray-500">Maintenance Collection</button>
                        <button data-tab="expenses" class="py-4 px-1 border-b-2 font-medium text-sm text-gray-500">Expenses</button>
                    </nav>
                </div>

                <div id="tab-content">
                    <div id="status-tab">
                         <div class="bg-white p-6 rounded-lg shadow-md">
                             <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-semibold">Payment Status</h2>
                                <div class="flex gap-2" id="status-filters">
                                    <button data-filter="all" class="bg-blue-500 text-white px-3 py-1 text-sm rounded">All</button>
                                    <button data-filter="pending" class="bg-gray-200 px-3 py-1 text-sm rounded">Pending</button>
                                    <button data-filter="paid" class="bg-gray-200 px-3 py-1 text-sm rounded">Paid</button>
                                </div>
                             </div>
                             <div class="overflow-x-auto"><table class="w-full">
                                 <thead class="bg-slate-50"><tr>
                                     <th class="p-3 text-left text-xs uppercase">Flat No.</th><th class="p-3 text-left text-xs uppercase">Owner Name</th><th class="p-3 text-left text-xs uppercase">Status</th>
                                 </tr></thead>
                                 <tbody id="payment-status-table" class="divide-y"></tbody>
                             </table></div>
                         </div>
                    </div>
                    <div id="collection-tab" class="hidden">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-2xl font-semibold mb-4">Log Maintenance Collection</h2>
                            <form id="maintenance-form" class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-end mb-6">
                                <div><label class="text-sm">Date</label><input type="date" id="m-date" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                                <div><label class="text-sm">Flat No.</label><select id="m-flat" required class="mt-1 w-full p-2 border-slate-300 rounded"></select></div>
                                <div><label class="text-sm">Owner Name</label><input type="text" id="m-name" readonly class="mt-1 w-full p-2 bg-slate-100 border-slate-300 rounded"></div>
                                <div><label class="text-sm">Amount</label><input type="number" id="m-amount" readonly class="mt-1 w-full p-2 bg-slate-100 border-slate-300 rounded"></div>
                                <div class="sm:col-span-2"><label class="text-sm">Payment Mode</label><select id="m-mode" class="mt-1 w-full p-2 border-slate-300 rounded"><option>UPI</option><option>Bank Transfer</option><option>Cash</option><option>Cheque</option></select></div>
                                <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-md sm:col-span-2">Add Collection</button>
                            </form>
                             <h3 class="text-xl font-semibold mt-8 mb-4">Collection Log</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-50"><tr><th class="p-3 text-left text-xs uppercase">Date</th><th class="p-3 text-left text-xs uppercase">Flat / Resident</th><th class="p-3 text-left text-xs uppercase">Amount</th><th class="p-3 text-left text-xs uppercase">Mode</th></tr></thead>
                                    <tbody id="collection-log-table" class="divide-y"></tbody>
                                </table>
                                <p id="no-collections-message" class="text-center text-slate-500 py-8 hidden">No collections logged yet.</p>
                            </div>
                        </div>
                    </div>
                    <div id="expenses-tab" class="hidden">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-2xl font-semibold mb-4">Log Expense</h2>
                            <form id="expense-form" class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-end mb-6">
                                <div><label class="text-sm">Date</label><input type="date" id="e-date" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                                <div><label class="text-sm">Amount</label><input type="number" id="e-amount" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                                <div class="sm:col-span-2"><label class="text-sm">Description</label><input type="text" id="e-desc" required class="mt-1 w-full p-2 border-slate-300 rounded"></div>
                                <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-md sm:col-span-2">Add Expense</button>
                            </form>
                             <h3 class="text-xl font-semibold mt-8 mb-4">Expense Log</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-50"><tr><th class="p-3 text-left text-xs uppercase">Date</th><th class="p-3 text-left text-xs uppercase">Description</th><th class="p-3 text-left text-xs uppercase">Amount</th><th class="p-3 text-center text-xs uppercase">Actions</th></tr></thead>
                                    <tbody id="expense-log-table" class="divide-y"></tbody>
                                </table>
                                <p id="no-expenses-message" class="text-center text-slate-500 py-8 hidden">No expenses logged yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-slate-800 text-white py-3 px-6 rounded-lg shadow-lg z-50"><span id="toast-message"></span></div>

    <script type="module" src="js/app.js"></script>
</body>
</html>